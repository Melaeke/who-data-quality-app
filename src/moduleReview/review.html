<h3 class="no-print" style="margin-top: 20px;">Annual Data Quality Report</h3>
<div class="no-print" ng-if="!revCtrl.notPossible">
	<uib-accordion class="no-print" close-others="revCtrl.oneAtATime">

		<!-- DATA -->
		<uib-accordion-group heading="Data" is-open="revCtrl.status.isFirstOpen">
			<label>Group</label><br/>
			<ui-select ng-model="revCtrl.groupSelected" theme="bootstrap" style="min-width: 200px; display: inline-block;">
				<ui-select-match placeholder="Select group...">
					{{revCtrl.groupSelected.name}}
				</ui-select-match>
				<ui-select-choices
						repeat="obj in revCtrl.groups | filter: $select.search">
					<div ng-bind-html="obj.name | highlight: $select.search"></div>
				</ui-select-choices>
			</ui-select>
		</uib-accordion-group>

		<uib-accordion-group heading="Period">
			<label>Year</label><br/>
			<ui-select ng-model="revCtrl.yearSelected" theme="bootstrap" style="width: 100px; display: inline-block;">
				<ui-select-match placeholder="Select year...">
					{{revCtrl.yearSelected.name}}
				</ui-select-match>
				<ui-select-choices
						repeat="obj in revCtrl.years | filter: $select.search">
					<div ng-bind-html="obj.name | highlight: $select.search"></div>
				</ui-select-choices>
			</ui-select>
		</uib-accordion-group>

		<uib-accordion-group heading="Organisation unit">
			<d2-select-orgunit default-level="1" max-level="2" ng-model="revCtrl.selectedOrgunit"></d2-select-orgunit>
		</uib-accordion-group>

	</uib-accordion>

	<div class="inline pull-right" style="margin-bottom:20px">
		<button ng-disabled="(!self.userOrgunit && !revCtrl.selectedOrgunit.level.displayName && !revCtrl.groupSelected) || revCtrl.outstandingRequests > 0" class="btn btn-primary inline" ng-click="revCtrl.doAnalysis();">Generate</button>
		<button ng-disabled="!(revCtrl.outstandingRequests === 0 && revCtrl.totalRequests != 0)" class="btn btn-primary inline" ng-click="revCtrl.doPrint();">Print</button>
	</div>

	<hr style="clear: both;" />
</div>


<div ng-if="revCtrl.outstandingRequests != 0">
	<h5>Loading data...</h5>
	<uib-progressbar animate="false" value="revCtrl.progress()" type="default">
		<b>{{revCtrl.progress()}}%</b>
	</uib-progressbar>
</div>

<div class="onlyPrint reportPart noBreak" style="display: inline-block; height: 1400px;">
	<div style="width: 200px; height: 200px; display: inline-block; vertical-align: top; ">
		<svg width="200px" height="228px">
			<rect width="200px" height="228px" style="fill:green;"/>
		</svg>
		<svg width="200px" height="228px">
			<rect width="200px" height="228px" style="fill:yellow;"/>
		</svg>
		<svg width="200px" height="228px">
			<rect width="200px" height="228px" style="fill:red;"/>
		</svg>
		<svg width="200px" height="228px">
			<rect width="200px" height="228px" style="fill:green;"/>
		</svg>
		<svg width="200px" height="228px">
			<rect width="200px" height="228px" style="fill:yellow;"/>
		</svg>
		<svg width="200px" height="228px">
			<rect width="200px" height="228px" style="fill:red;"/>
		</svg>
	</div>
	<div style="display: inline-block; width: 650px; vertical-align: top; ">
		<h2 style="text-align: center; margin-top: 500px; margin-left: 100px; width: 400px;">Assessment of Health Facility Data Quality</h2>
		<h3 style="text-align: center; margin-top: 100px; margin-left: 100px; width: 400px;">WHO Data Quality Review</h3>
		<h3 style="text-align: center; margin-left: 100px; width: 400px;">{{revCtrl.selectedOrgunit.boundary.displayName}} - {{revCtrl.yearSelected.id}}</h3>
	</div>
</div>

<div class="reviewResult reportPart" ng-if="revCtrl.outstandingRequests === 0 && revCtrl.totalRequests != 0">
	<!--SUMMARY-->
	<div class="reportPart">
		<div class="fullWidth headerPart">
			SUMMARY
		</div>
		<div>
			<div class="noBreak">

				<div class="fullWidth headerSection">
					Domain 1: Completeness
				</div>

				<table class="table tablePrint table-bordered table-condensed noBreak">
					<tbody>
						<tr bgcolor="#f9f9f9">
							<th colspan="4">
								<em>1a: Completeness of facility reporting.</em>
								The percentage of expected reports that have been entered and completed.
							</th>
						</tr>
						<tr bgcolor="#f9f9f9">
							<th width="275">Dataset</th>
							<th width="175">Overall score (%)</th>
							<th width="175"># {{revCtrl.selectedOrgunit.level.displayName}} with poor score</th>
							<th width="175">% {{revCtrl.selectedOrgunit.level.displayName}} with poor score</th>
						</tr>
						<tr ng-repeat="dataset in revCtrl.completeness.datasets | orderBy : 'dxName'">
							<td>{{dataset.dxName}}</td>
							<td ng-if="revCtrl.isNumber(dataset.boundaryValue)" class="valueCell">{{dataset.boundaryValue}}%</td>
							<td ng-if="revCtrl.isNumber(dataset.boundaryValue)" class="valueCell">{{dataset.subunitsOutsideThreshold}}</td>
							<td ng-if="revCtrl.isNumber(dataset.boundaryValue)" class="valueCell">{{dataset.subunitViolationPercentage}}%</td>
							<td ng-if="!revCtrl.isNumber(dataset.boundaryValue)" colspan="3">Not available</td>
						</tr>
					</tbody>
				</table>
			</div>

			<div class="noBreak">
				<table class="table tablePrint table-bordered table-condensed noBreak">
					<tbody>
						<tr bgcolor="#f9f9f9">
							<th colspan="4">
								<em>1b: Completeness of indicator data (missing or zero values)</em>
							</th>
						</tr>
						<tr bgcolor="#f9f9f9">
							<th width="275">Dataset</th>
							<th width="175">Overall score (%)</th>
							<th width="175"># {{revCtrl.selectedOrgunit.level.displayName}} with poor score</th>
							<th width="175">% {{revCtrl.selectedOrgunit.level.displayName}} with poor score</th>
						</tr>
						<tr ng-repeat="indicator in revCtrl.completeness.indicators | orderBy : 'dxName'">
							<td>{{indicator.dxName}}</td>
							<td ng-if="revCtrl.isNumber(indicator.boundaryValue)" class="valueCell">{{indicator.boundaryValue}}%</td>
							<td ng-if="revCtrl.isNumber(indicator.boundaryValue)" class="valueCell">{{indicator.subunitsOutsideThreshold}}</td>
							<td ng-if="revCtrl.isNumber(indicator.boundaryValue)" class="valueCell">{{indicator.subunitViolationPercentage}}%</td>
							<td ng-if="!revCtrl.isNumber(indicator.boundaryValue)" colspan="3">Not available</td>
						</tr>
					</tbody>
				</table>
			</div>

			<div class="noBreak">
				<table class="table tablePrint table-bordered table-condensed noBreak">
					<tbody>
						<tr bgcolor="#f9f9f9">
							<th colspan="4">
								<em>1c: Consistency of dataset completeness over time. </em>
								Completeness of datasets in {{revCtrl.yearSelected.id}} compared to previous three years.
							</th>
						</tr>
						<tr bgcolor="#f9f9f9">
							<th width="275">Dataset</th>
							<th width="175">Overall score (%)</th>
							<th width="175"># {{revCtrl.selectedOrgunit.level.displayName}} with poor score</th>
							<th width="175">% {{revCtrl.selectedOrgunit.level.displayName}} with poor score</th>
						</tr>
						<tr ng-repeat="dataset in revCtrl.completeness.consistency | orderBy:'dxNameA'">
							<td>{{dataset.dxNameA}}</td>
							<td ng-if="revCtrl.isNumber(dataset.boundaryPercentage)" class="valueCell">{{dataset.boundaryPercentage}}%</td>
							<td ng-if="revCtrl.isNumber(dataset.boundaryPercentage)" class="valueCell">{{dataset.subunitsOutsideThreshold}}</td>
							<td ng-if="revCtrl.isNumber(dataset.boundaryPercentage)" class="valueCell">{{dataset.subunitViolationPercentage}}%</td>
							<td ng-if="!revCtrl.isNumber(dataset.boundaryPercentage)" colspan="3">Not available</td>
						</tr>
					</tbody>
				</table>
			</div>

			<div class="noBreak">
				<div class="fullWidth headerSection">
					Domain 2: Internal consistency
				</div>

				<table class="table tablePrint table-bordered table-condensed noBreak">
					<tbody>
						<tr bgcolor="#f9f9f9">
							<th colspan="4">
								<em>2a: Extreme outliers.</em>
							</th>
						</tr>
						<tr bgcolor="#f9f9f9">
							<th width="275">Indicator</th>
							<th width="175">Overall score (%)</th>
							<th width="175"># {{revCtrl.selectedOrgunit.level.displayName}} with poor score</th>
							<th width="175">% {{revCtrl.selectedOrgunit.level.displayName}} with poor score</th>
						</tr>
						<tr ng-repeat="indicator in revCtrl.outliers | orderBy:'displayName'">
							<td>{{indicator.displayName}}</td>
							<td ng-if="revCtrl.isNumber(indicator.boundaryExtreme)" class="valueCell">{{indicator.boundaryExtreme}}%</td>
							<td ng-if="revCtrl.isNumber(indicator.boundaryExtreme)" class="valueCell">{{indicator.countExtreme}}</td>
							<td ng-if="revCtrl.isNumber(indicator.boundaryExtreme)" class="valueCell">{{indicator.percentExtreme}}%</td>
							<td ng-if="!revCtrl.isNumber(indicator.boundaryExtreme)" colspan="3">Not available</td>
						</tr>
					</tbody>
				</table>
			</div>

			<div class="noBreak">

				<table class="table tablePrint table-bordered table-condensed noBreak">
					<tbody>
						<tr bgcolor="#f9f9f9">
							<th colspan="4">
								<em>2b: Moderate outliers.</em>
								Outliers relative to the mean.
							</th>
						</tr>
						<tr bgcolor="#f9f9f9">
							<th width="275">Indicator</th>
							<th width="175">Overall score (%)</th>
							<th width="175"># {{revCtrl.selectedOrgunit.level.displayName}} with poor score</th>
							<th width="175">% {{revCtrl.selectedOrgunit.level.displayName}} with poor score</th>
						</tr>
						<tr ng-repeat="indicator in revCtrl.outliers | orderBy:'displayName'">
							<td>{{indicator.displayName}}</td>
							<td ng-if="revCtrl.isNumber(indicator.boundaryModerate)" class="valueCell">{{indicator.boundaryModerate}}%</td>
							<td ng-if="revCtrl.isNumber(indicator.boundaryModerate)" class="valueCell">{{indicator.countModerate}}</td>
							<td ng-if="revCtrl.isNumber(indicator.boundaryModerate)" class="valueCell">{{indicator.percentModerate}}%</td>
							<td ng-if="!revCtrl.isNumber(indicator.boundaryModerate)" colspan="3">Not available</td>
						</tr>
					</tbody>
				</table>
			</div>

			<div class="noBreak">

				<table class="table tablePrint table-bordered table-condensed noBreak">
					<tbody>
						<tr bgcolor="#f9f9f9">
							<th colspan="4">
								<em>2c: Moderate outliers.</em>
								Outliers relative to the median (modified Z-score > 3.5).
							</th>
						</tr>
						<tr bgcolor="#f9f9f9">
							<th width="275">Indicator</th>
							<th width="175">Overall score (%)</th>
							<th width="175"># {{revCtrl.selectedOrgunit.level.displayName}} with poor score</th>
							<th width="175">% {{revCtrl.selectedOrgunit.level.displayName}} with poor score</th>
						</tr>
						<tr ng-repeat="indicator in revCtrl.outliers | orderBy:'displayName'">
							<td>{{indicator.displayName}}</td>
							<td ng-if="revCtrl.isNumber(indicator.boundaryZscore)" class="valueCell">{{indicator.boundaryZscore}}%</td>
							<td ng-if="revCtrl.isNumber(indicator.boundaryZscore)"class="valueCell">{{indicator.countZscore}}</td>
							<td ng-if="revCtrl.isNumber(indicator.boundaryZscore)"class="valueCell">{{indicator.percentZscore}}%</td>
							<td ng-if="!revCtrl.isNumber(indicator.boundaryZscore)" colspan="3">Not available</td>
						</tr>
					</tbody>
				</table>
			</div>

			<div class="noBreak">
				<table class="table tablePrint table-bordered table-condensed noBreak">
					<tbody>
						<tr bgcolor="#f9f9f9">
							<th colspan="4">
								<em>2d: Consistency over time.</em>
							</th>
						</tr>
						<tr bgcolor="#f9f9f9">
							<th width="275">Indicator</th>
							<th width="175">Overall score (%)</th>
							<th width="175"># {{revCtrl.selectedOrgunit.level.displayName}} with poor score</th>
							<th width="175">% {{revCtrl.selectedOrgunit.level.displayName}} with poor score</th>
						</tr>
						<tr ng-repeat="indicator in revCtrl.consistency.data | orderBy:'dxNameA'">
							<td>{{indicator.dxNameA}}</td>
							<td ng-if="revCtrl.isNumber(indicator.boundaryPercentage)" class="valueCell">{{indicator.boundaryPercentage}}%</td>
							<td ng-if="revCtrl.isNumber(indicator.boundaryPercentage)" class="valueCell">{{indicator.subunitsOutsideThreshold}}</td>
							<td ng-if="revCtrl.isNumber(indicator.boundaryPercentage)" class="valueCell">{{indicator.subunitViolationPercentage}}%</td>
							<td ng-if="!revCtrl.isNumber(indicator.boundaryPercentage)" colspan="3">Not available</td>
						</tr>
					</tbody>
				</table>
			</div>

			<div class="noBreak">

				<table class="table tablePrint table-bordered table-condensed ">
					<tbody>
						<tr bgcolor="#f9f9f9">
							<th colspan="4">
								<em>2e: Consistency between related indicators.</em>
							</th>
						</tr>
						<tr bgcolor="#f9f9f9">
							<th width="275">Indicator</th>
							<th width="175">Overall score (%)</th>
							<th width="175"># {{revCtrl.selectedOrgunit.level.displayName}} with poor score</th>
							<th width="175">% {{revCtrl.selectedOrgunit.level.displayName}} with poor score</th>
						</tr>
						<tr ng-repeat="relation in revCtrl.consistency.relations | orderBy:'meta.name'">
							<td>{{revCtrl.relationName(relation.relationCode)}}</td>
							<td ng-if="revCtrl.isNumber(relation.boundaryPercentage)" class="valueCell">{{relation.boundaryPercentage}}%</td>
							<td ng-if="revCtrl.isNumber(relation.boundaryPercentage)" class="valueCell">{{relation.subunitsOutsideThreshold}}</td>
							<td ng-if="revCtrl.isNumber(relation.boundaryPercentage)" class="valueCell">{{relation.subunitViolationPercentage}}%</td>
							<td ng-if="!revCtrl.isNumber(relation.boundaryPercentage)" colspan="3">Not available</td>
						</tr>
					</tbody>
				</table>
			</div>


			<div class="noBreak">
				<div class="fullWidth headerSection">
							Domain 3: External comparison
				</div>
				<table class="table tablePrint table-bordered table-condensed noBreak">
					<tr bgcolor="#f9f9f9">
						<th colspan="2">
							<em>3a Comparison of routine data with survey values.</em>
						</th>
					</tr>
				</table>
			</div>


			<div class="noBreak">
				<div class="fullWidth headerSection">
					Domain 4: Consistency of Population Data
				</div>

				<table class="table tablePrint table-bordered table-condensed noBreak">
					<tr bgcolor="#f9f9f9">
						<th colspan="2">
							<em>4a: Consistency with UN projections.</em>
						</th>
					</tr>
					<tr bgcolor="#f9f9f9">
						<th width="275">Indicator</th>
						<th width="175">Overall score (%)</th>
					</tr>
					<tr>
						<td>Consistency with United Nations Population Projections for Live Births</td>
						<td ng-if="revCtrl.denominators.un">{{revCtrl.denominators.un.boundaryRatio}}%</td>
						<td ng-if="!revCtrl.denominators.un">Not available</td>
					</tr>
				</table>
			</div>
			<div class="noBreak">
				<table class="table tablePrint table-bordered table-condensed noBreak">
					<tr bgcolor="#f9f9f9">
						<th colspan="4">
							<em>4b: Consistency of population/denominator data.</em>
						</th>
					</tr>
					<tr bgcolor="#f9f9f9">
						<th width="275">Indicator</th>
						<th width="175">Overall score (%)</th>
						<th width="175"># {{revCtrl.selectedOrgunit.level.displayName}} with poor score</th>
						<th width="175">% {{revCtrl.selectedOrgunit.level.displayName}} with poor score</th>
					</tr>
					<tr ng-repeat="denominator in revCtrl.denominators.relations | orderBy:'name'">
						<td>{{denominator.meta.relation.name}}</td>
						<td class="valueCell">{{denominator.boundaryPercentage}}%</td>
						<td class="valueCell">{{denominator.subunitsOutsideThreshold}}</td>
						<td class="valueCell">{{denominator.subunitViolationPercentage}}%</td>
					</tr>
					<tr ng-if="!revCtrl.denominators.relations || revCtrl.denominator.relations.length === 0">
						<td colspan="4">Not available</td>
					</tr>

				</table>
			</div>
		</div>
	</div>


	<!--COMPLETENESS-->
	<div class="reportPart">
		<div class="fullWidth headerPart">
			DOMAIN 1: COMPLETENESS OF REPORTING
		</div>

		<div class="noBreak">
			<table class="table tablePrint table-bordered table-condensed ">
				<thead>
					<tr bgcolor="#f9f9f9">
						<th colspan="4">
							<em>1a: Completeness of facility reporting.</em>
							The percentage of expected reports that have been entered and completed.
						</th>
					</tr>
					<tr bgcolor="#f9f9f9">
						<th width="200">Dataset</th>
						<th width="260">Indicator</th>
						<th width="80">{{revCtrl.yearSelected.name}}</th>
						<th>Names</th>
					</tr>
				</thead>
				<tbody ng-repeat="dataset in revCtrl.completeness.datasets| orderBy:'dxName':false">
					<tr ng-if="revCtrl.isNumber(dataset.boundaryValue)">
						<td rowspan="3">{{dataset.dxName}}</td>
						<td>Overall score (%)</td>
						<td class="valueCell">{{dataset.boundaryValue}}%</td>
						<td rowspan="3">{{dataset.subunitViolationNames.join(', ')}}</td>
					</tr>
					<tr ng-if="!revCtrl.isNumber(dataset.boundaryValue)">
						<td>{{dataset.dxName}}</td>
						<td colspan="3">Not available</td>
					</tr>
					<tr ng-if="revCtrl.isNumber(dataset.boundaryValue)">
						<td># {{revCtrl.selectedOrgunit.level.displayName}} with completeness below {{dataset.threshold}}%</td>
						<td class="valueCell">{{dataset.subunitsOutsideThreshold}}</td>
					</tr>
					<tr ng-if="revCtrl.isNumber(dataset.boundaryValue)">
						<td>% {{revCtrl.selectedOrgunit.level.displayName}} with completeness below {{dataset.threshold}}%</td>
						<td class="valueCell">{{dataset.subunitViolationPercentage}}%</td>
					</tr>
				</tbody>
			</table>
			<h5>Interpretations</h5>
			<textarea class="interpretation"></textarea>
		</div>

		<div class="noBreak">
			<table class="table tablePrint table-bordered table-condensed ">
				<tbody>
					<tr bgcolor="#f9f9f9">
						<th colspan="6">
							<em>1b: Completeness of indicator data (missing/zero values).</em>
						</th>
					</tr>
					<tr bgcolor="#f9f9f9">
						<th width="200">Indicator</th>
						<th width="80">Threshold</th>
						<th width="80">Overall score (%)</th>
						<th width="110"># {{revCtrl.selectedOrgunit.level.displayName}} with poor score</th>
						<th width="110">% {{revCtrl.selectedOrgunit.level.displayName}} with poor score</th>
						<th>Names</th>
					</tr>
					<tr ng-repeat="indicator in revCtrl.completeness.indicators | orderBy : 'dxName'">
						<td>{{indicator.dxName}}</td>
						<td>{{indicator.threshold}}%</td>
						<td class="valueCell">{{indicator.boundaryValue}}%</td>
						<td class="valueCell">{{indicator.subunitsOutsideThreshold}}</td>
						<td class="valueCell">{{indicator.subunitViolationPercentage}}%</td>
						<td class="valueCell">{{indicator.subunitViolationNames.join(', ')}}</td>
					</tr>
				</tbody>
			</table>

			<h5>Interpretations</h5>
			<textarea class="interpretation"></textarea>
		</div>

		<div class="noBreak">

			<table class="table tablePrint table-bordered table-condensed ">
				<tr bgcolor="#f9f9f9">
					<th colspan="7">
						<em>1c: Consistency of dataset completeness over time.</em>
						Difference between the current year completeness and either the average of the 3 preceding years (if expected trend is constant), or the forecasted value.
					</th>
				</tr>
				<tr bgcolor="#f9f9f9">
					<th width="200">Dataset</th>
					<th width="80">Expected trend</th>
					<th width="80">Quality threshold</th>
					<th width="80">Overall score (%)</th>
					<th width="110"># {{revCtrl.selectedOrgunit.level.displayName}} with poor score</th>
					<th width="110">% {{revCtrl.selectedOrgunit.level.displayName}} with poor score</th>
					<th>Names</th>
				</tr>
				<tr ng-repeat="dataset in revCtrl.completeness.consistency| orderBy:'dxNameA':false">
					<td>{{dataset.dxNameA}}</td>
					<td>{{dataset.subType}}</td>
					<td class="valueCell">{{dataset.criteria}}%</td>
					<td ng-if="revCtrl.isNumber(dataset.boundaryPercentage)" class="valueCell">{{dataset.boundaryPercentage}}%</td>
					<td ng-if="revCtrl.isNumber(dataset.boundaryPercentage)" class="valueCell">{{dataset.subunitsOutsideThreshold}}</td>
					<td ng-if="revCtrl.isNumber(dataset.boundaryPercentage)" class="valueCell">{{dataset.subunitViolationPercentage}}%</td>
					<td ng-if="revCtrl.isNumber(dataset.boundaryPercentage)" >{{dataset.subunitViolationNames.join(', ')}}</td>
					<td ng-if="!revCtrl.isNumber(dataset.boundaryPercentage)" colspan="4">Not available</td>
				</tr>
			</table>

			<h5>Interpretations</h5>
			<textarea class="interpretation"></textarea>
		</div>


		<div style="border: 1px dashed gray" class="noBreak" >
			<h5 class="chartTitle">Reporting completeness over time</h5>
			<div class="bigChart">
				<nvd3 options='revCtrl.datasetConsistencyChart.options' data='revCtrl.datasetConsistencyChart.data'></nvd3>
			</div>
		</div>
	</div>


	<!--INTERNAL CONSISTENCY-->
	<div class="reportPart">
		<div class="fullWidth headerPart">
			DOMAIN 2: INTERNAL CONSISTENCY OF REPORTED DATA
		</div>

		<div class="noBreak">

			<table class="table tablePrint table-bordered table-condensed ">
				<tbody>
					<tr bgcolor="#f9f9f9">
						<th colspan="6">
							<em>2a: Extreme outliers.</em>
						</th>
					</tr>
					<tr bgcolor="#f9f9f9">
						<th width="200">Indicator</th>
						<th width="80">Threshold</th>
						<th width="80">Overall score (%)</th>
						<th width="110"># {{revCtrl.selectedOrgunit.level.displayName}} with poor score</th>
						<th width="110">% {{revCtrl.selectedOrgunit.level.displayName}} with poor score</th>
						<th>Names</th>
					</tr>
					<tr ng-repeat="indicator in revCtrl.outliers | orderBy : 'displayName'">
						<td>{{indicator.displayName}}</td>
						<td class="valueCell">{{indicator.extremeOutlier}} SD</td>
						<td ng-if="revCtrl.isNumber(indicator.boundaryExtreme)" class="valueCell">{{indicator.boundaryExtreme}}%</td>
						<td ng-if="revCtrl.isNumber(indicator.boundaryExtreme)" class="valueCell">{{indicator.countExtreme}}</td>
						<td ng-if="revCtrl.isNumber(indicator.boundaryExtreme)" class="valueCell">{{indicator.percentExtreme}}%</td>
						<td ng-if="revCtrl.isNumber(indicator.boundaryExtreme)" class="valueCell">{{indicator.namesExtreme.join(', ')}}</td>
						<td ng-if="!revCtrl.isNumber(indicator.boundaryExtreme)" colspan="5" >Not available</td>
					</tr>
				</tbody>
			</table>

			<h5>Interpretations</h5>
			<textarea class="interpretation"></textarea>
		</div>

		<div class="noBreak">
			<table class="table tablePrint table-bordered table-condensed ">
				<tbody>
					<tr bgcolor="#f9f9f9">
						<th colspan="6">
							<em>2b: Moderate outliers.</em>
						</th>
					</tr>
					<tr bgcolor="#f9f9f9">
						<th width="200">Indicator</th>
						<th width="80">Threshold</th>
						<th width="80">Overall score (%)</th>
						<th width="110"># {{revCtrl.selectedOrgunit.level.displayName}} with poor score</th>
						<th width="110">% {{revCtrl.selectedOrgunit.level.displayName}} with poor score</th>
						<th>Names</th>
					</tr>
					<tr ng-repeat="indicator in revCtrl.outliers | orderBy : 'displayName'">
						<td>{{indicator.displayName}}</td>
						<td class="valueCell">{{indicator.moderateOutlier}} SD</td>
						<td ng-if="revCtrl.isNumber(indicator.boundaryModerate)" class="valueCell">{{indicator.boundaryModerate}}%</td>
						<td ng-if="revCtrl.isNumber(indicator.boundaryModerate)" class="valueCell">{{indicator.countModerate}}</td>
						<td ng-if="revCtrl.isNumber(indicator.boundaryModerate)" class="valueCell">{{indicator.percentModerate}}%</td>
						<td ng-if="revCtrl.isNumber(indicator.boundaryModerate)" class="valueCell">{{indicator.namesModerate.join(', ')}}</td>
						<td ng-if="!revCtrl.isNumber(indicator.boundaryModerate)" colspan="4" >Not available</td>
					</tr>
				</tbody>
			</table>


			<h5>Interpretations</h5>
			<textarea class="interpretation"></textarea>
		</div>

		<div class="noBreak">

			<table class="table tablePrint table-bordered table-condensed ">
				<tbody>
					<tr bgcolor="#f9f9f9">
						<th colspan="6">
							<em>2c: Moderate outliers.</em> Based on median (modified Z score).
						</th>
					</tr>
					<tr bgcolor="#f9f9f9">
						<th width="200">Indicator</th>
						<th width="80">Threshold</th>
						<th width="80">Overall score (%)</th>
						<th width="110"># {{revCtrl.selectedOrgunit.level.displayName}} with poor score</th>
						<th width="110">% {{revCtrl.selectedOrgunit.level.displayName}} with poor score</th>
						<th>Names</th>
					</tr>
					<tr ng-repeat="indicator in revCtrl.outliers | orderBy : 'displayName'">
						<td>{{indicator.displayName}}</td>
						<td class="valueCell">3.5</td>
						<td ng-if="revCtrl.isNumber(indicator.boundaryZscore)"  class="valueCell">{{indicator.boundaryZscore}}%</td>
						<td ng-if="revCtrl.isNumber(indicator.boundaryZscore)"  class="valueCell">{{indicator.countZscore}}</td>
						<td ng-if="revCtrl.isNumber(indicator.boundaryZscore)"  class="valueCell">{{indicator.percentZscore}}%</td>
						<td ng-if="revCtrl.isNumber(indicator.boundaryZscore)"  class="valueCell">{{indicator.namesZscore.join(', ')}}</td>
						<td ng-if="!revCtrl.isNumber(indicator.boundaryZscore)" colspan="4" >Not available</td>
					</tr>
				</tbody>
			</table>

			<h5>Interpretations</h5>
			<textarea class="interpretation"></textarea>
		</div>

		<div class="inline fullWidth">
			<div class="noBreak" style="margin-bottom: 10px;"
				 ng-repeat="indicator in revCtrl.consistency.data | orderBy:'dxNameA' track by $index">

				<div ng-if="$index === 0" class="inline fullWidth">
					<table class="table tablePrint table-bordered table-condensed" style="margin-bottom: 5px">
						<tbody>
						<tr bgcolor="#f9f9f9">
							<th>
								<em>2d: Consistency of indicator values over time.</em>
								Difference between the current year and either the average of the 3 preceding years (if expected trend is constant), or the forecasted value.
							</th>
						</tr>
						</tbody>
					</table>
				</div>

				<div class="inline relationTable halfWidth">
					<table class="table tablePrint table-bordered table-condensed" style="margin-bottom: 5px">
						<tr bgcolor="#f9f9f9"><th colspan="2">{{indicator.dxNameA}}</th></tr>
						<tr>
							<td>Expected trend</td>
							<td class="valueCell">{{indicator.subType}}</td>
						</tr>
						<tr>
							<td>Compare {{revCtrl.selectedOrgunit.level.displayName}} with</td>
							<td ng-if="true" class="valueCell">{{revCtrl.selectedOrgunit.boundary.displayName}}</td>
							<td ng-if="!true && indicator.subType === constant" class="valueCell">Current vs average</td>
							<td ng-if="!true && indicator.subType != constant" class="valueCell">Current vs forecast</td>
						</tr>
						<tr>
							<td>Quality threshold</td>
							<td class="valueCell">± {{indicator.criteria}}%</td>
						</tr>
						<tr>
							<td>Overall score (%)</td>
							<td ng-if="revCtrl.isNumber(indicator.boundaryPercentage)" class="valueCell">{{indicator.boundaryPercentage}}%</td>
						</tr>
						<tr>
							<td># {{revCtrl.selectedOrgunit.level.displayName}} with poor score</td>
							<td ng-if="revCtrl.isNumber(indicator.boundaryPercentage)" class="valueCell">{{indicator.subunitsOutsideThreshold}}</td>
						</tr>
						<tr>
							<td>% {{revCtrl.selectedOrgunit.level.displayName}} with poor score</td>
							<td ng-if="revCtrl.isNumber(indicator.boundaryPercentage)" class="valueCell">{{indicator.subunitViolationPercentage}}%</td>
						</tr>
						<tr class="bigRow">
							<td colspan="2">{{indicator.subunitViolationNames.join(', ')}}</td>
						</tr>
					</table>

					<!--Line chart with last 4 years of data-->
					<div class="tinyChart" style="border: 1px dashed gray;">
						<nvd3 options='indicator.trendChartOptions' data='indicator.trendChartData'></nvd3>
					</div>
				</div>
				<div class="halfWidth inline" style="float: right">
					<div class="dottedBox relationChartBig">
						<nvd3 options='indicator.chartOptions' data='indicator.chartData'></nvd3>
					</div>
				</div>

				<h5 style="margin-top: 10px;">Interpretations</h5>
				<textarea class="interpretation"></textarea>
			</div>
		</div>


		<div class="noBreak inline fullWidth"
			 style="margin-bottom: 10px;"
			 ng-repeat="relation in revCtrl.consistency.relations | orderBy:'meta.name' track by $index">

			<div ng-if="$index === 0" class="inline fullWidth">
				<table class="table tablePrint table-bordered table-condensed" style="margin-bottom: 5px">
					<tbody>
					<tr bgcolor="#f9f9f9">
						<th>
							2e: Consistency between related indicators</em>
						</th>
					</tr>
					</tbody>
				</table>
			</div>

			<div class="inline relationTable halfWidth">
				<table class="table tablePrint table-bordered table-condensed">
					<tr bgcolor="#f9f9f9"><th colspan="2">{{revCtrl.relationName(relation.relationCode)}}</th></tr>
					<tr>
						<td>Expected relationship</td>
						<td class="valueCell">{{revCtrl.relationType(relation.subType).name}}</td>
					</tr>
					<tr>
						<td>Quality threshold</td>
						<td class="valueCell"  ng-if="relation.subType != 'do'">± {{relation.criteria}} %</td>
						<td class="valueCell" ng-if="relation.subType === 'do'">Not negative</td>
					</tr>
					<tr>
						<td>National score</td>
						<td ng-if="revCtrl.isNumber(relation.boundaryPercentage)" class="valueCell">{{relation.boundaryPercentage}}%</td>
						<td class="valueCell" rowspan="3" ng-if="!revCtrl.isNumber(relation.boundaryPercentage)">Not available</td>
						</tr>
					<tr>
						<td># {{revCtrl.selectedOrgunit.level.displayName}} with poor score</td>
						<td ng-if="revCtrl.isNumber(relation.boundaryPercentage)" class="valueCell">{{relation.subunitsOutsideThreshold}}</td>
					</tr>
					<tr>
						<td>% {{revCtrl.selectedOrgunit.level.displayName}} with poor score</td>
						<td ng-if="revCtrl.isNumber(relation.boundaryPercentage)" class="valueCell">{{relation.subunitViolationPercentage}}%</td>
					</tr>
					<tr class="bigRow">
						<td colspan="2">{{relation.subunitViolationNames.join(', ')}}</td>
					</tr>
				</table>
			</div>
			<div class="halfWidth inline" style="float: right">
				<div class="dottedBox relationChart">
					<nvd3 options='relation.chartOptions' data='relation.chartData'></nvd3>
				</div>
			</div>

			<h5 style="margin-top: 10px;">Interpretations</h5>
			<textarea class="interpretation"></textarea>
		</div>
	</div>


	<!--EXTERNAL CONSISTENCY-->
	<div class="reportPart">
		<div class="fullWidth headerPart">
			DOMAIN 3: EXTERNAL COMPARISON
		</div>
	</div>


	<!--DENOMINATOR CONSISTENCY-->
	<div class="reportPart">
		<div class="fullWidth headerPart">
			DOMAIN 4: CONSISTENCY OF POPULATION DATA
		</div>
		<div class="noBreak">

			<table class="table tablePrint table-bordered table-condensed ">
				<tr bgcolor="#f9f9f9">
					<th colspan="2">
						<em>3a: Consistency with UN population projection.</em>
					</th>
				</tr>
				<tr>
					<td>Ratio of population projection of live births from the Bureau of Statistics to a UN live births projection</td>
					<td ng-if="revCtrl.denominators.un">{{revCtrl.denominators.un.boundaryRatio}}</td>
					<td ng-if="!revCtrl.denominators.un">Not available</td>
				</tr>
			</table>
		</div>


		<div class="noBreak inline fullWidth"
			 style="margin-bottom: 10px;"
			 ng-repeat="denominator in revCtrl.denominators.relations | orderBy:'meta.relation.name' track by $index">


			<div ng-if="$index === 0" class="inline fullWidth">
				<table class="table tablePrint table-bordered table-condensed" style="margin-bottom: 5px">
					<tbody>
					<tr bgcolor="#f9f9f9">
						<th>
							<em>3b: Consistency of denominators</em>
						</th>
					</tr>
					</tbody>
				</table>
			</div>
			<div class="inline relationTable halfWidth">
				<table class="table tablePrint table-bordered table-condensed">
					<tr bgcolor="#f9f9f9"><th colspan="2">{{denominator.meta.relation.name}}</th></tr>
					<tr>
						<td>Year</td>
						<td>{{revCtrl.yearSelected.name}}</td>
					</tr>
					<tr>
						<td>Quality threshold</td>
						<td>{{denominator.criteria}}</td>
					</tr>
					<tr>
						<td>National score</td>
						<td>{{denominator.boundaryPercentage}}%</td>
					</tr>
					<tr>
						<td># {{revCtrl.selectedOrgunit.level.displayName}} with poor score</td>
						<td>{{denominator.subunitsOutsideThreshold}}</td>
					</tr>
					<tr>
						<td>% {{revCtrl.selectedOrgunit.level.displayName}} with poor score</td>
						<td>{{denominator.subunitViolationPercentage}}%</td>
					</tr>
					<tr class="biggerRow" ng-if="denominator.subunitViolationNames.length > 0">
						<td colspan="2">{{denominator.subunitViolationNames.join(', ')}}</td>
					</tr>
				</table>
			</div>
			<div class="halfWidth inline">
				<div class="dottedBox relationChart">
					<nvd3 options='denominator.chartOptions' data='denominator.chartData'></nvd3>
				</div>
			</div>

			<h5 style="margin-top: 10px;">Interpretations</h5>
			<textarea class="interpretation"></textarea>
		</div>
	</div>


	<!--ALERTS-->
	<div class="reportPart" ng-if="revCtrl.remarks.length > 0">
		<h3>Remarks</h3>
		<table class="table tablePrint table-bordered" style=" margin-top: 20px;">
			<tr>
				<th>Analysis type</th>
				<th>Item</th>
				<th>Remarks</th></tr>
			<tr ng-repeat="alert in revCtrl.remarks track by $index">
				<td>{{alert.type}}</td>
				<td>{{alert.item}}</td>
				<td>{{alert.msg}}</td>
			</tr>
		</table>
	</div>
</div>